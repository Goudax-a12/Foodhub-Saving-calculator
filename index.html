<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foodhub Savings Calculator</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --red:#E4002B;
  --green:#1FA971;
  --bg:#f5f6f8;
}
body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 12px;
}
.container {
  max-width: 500px;
  margin: auto;
}
.hidden { display: none !important; }

.header {
  background: var(--red);
  color: #fff;
  padding: 16px;
  border-radius: 12px;
  text-align: center;
}
.big-savings {
  background: #fff;
  margin-top: 12px;
  padding: 16px;
  border-radius: 12px;
  text-align: center;
}
.big-savings span {
  font-size: 30px;
  font-weight: bold;
  color: var(--green);
}

.section {
  background: #fff;
  margin-top: 12px;
  border-radius: 12px;
  overflow: hidden;
}
.section summary {
  padding: 14px;
  font-weight: bold;
  cursor: pointer;
  background: #f1f1f1;
}
.section .content {
  padding: 14px;
}

label {
  font-size: 14px;
  margin-top: 10px;
  display: block;
}
input, select {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
  font-size: 16px;
}
button {
  width: 100%;
  padding: 14px;
  margin-top: 16px;
  font-size: 18px;
  background: var(--red);
  color: #fff;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}
.result {
  font-weight: bold;
}
.notice {
  background: #fff3cd;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
}
canvas {
  margin-top: 20px;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <h2>Foodhub Savings Calculator</h2>
  </div>

  <div class="big-savings">
    Annual Savings
    <div><span id="annual">£0</span></div>
  </div>

  <button onclick="togglePitch()">Toggle Pitch Mode</button>

  <!-- INPUTS -->
  <div id="inputs">

    <details class="section" open>
      <summary>Agent & Store</summary>
      <div class="content">
        <label>Agent Name</label>
        <input id="agent">
        <label>Store Name</label>
        <input id="store">
      </div>
    </details>

    <details class="section">
      <summary>Orders</summary>
      <div class="content">
        <label>Online Orders</label>
        <input id="onlineOrders" type="number" value="1000">
        <label>Offline Orders</label>
        <input id="offlineOrders" type="number" value="300">
        <label>% Card Orders</label>
        <input id="cardRate" type="number" value="70">
        <label>Average Order Value (£)</label>
        <input id="aov" type="number" value="20">
      </div>
    </details>

    <details class="section">
      <summary>Competitor</summary>
      <div class="content">
        <label>Competitor</label>
        <select id="competitorName">
          <option>Flipdish</option>
          <option>Just Eat</option>
          <option>Uber Eats</option>
          <option>Deliveroo</option>
          <option>Other</option>
        </select>

        <label>Commission (%)</label>
        <input id="compCommission" value="2">

        <label>Commission Scope</label>
        <select id="commissionScope">
          <option value="card">Card only</option>
          <option value="all">Card + Cash</option>
        </select>

        <label>Commission on Offline Orders?</label>
        <select id="offlineCommission">
          <option value="no">No</option>
          <option value="yes">Yes</option>
        </select>

        <label>Monthly Fee (£)</label>
        <input id="compMonthlyFee" value="99">

        <label>Flat Fee (£ / card order)</label>
        <input id="compFlatFee" value="0.20">

        <label>Service Charge (£ / order)</label>
        <input id="compServiceCharge" value="0.50">
      </div>
    </details>

    <details class="section">
      <summary>Foodhub</summary>
      <div class="content">
        <label>Commission (%)</label>
        <input id="fhCommission" value="0">
        <label>Monthly Fee (£)</label>
        <input id="fhMonthlyFee" value="0">
        <label>Service Charge (£ / order to shop)</label>
        <input id="fhServiceCharge" value="0.50">
        <label>Card Fee (£ / card order)</label>
        <input id="fhCardFee" value="0.20">
      </div>
    </details>

  </div>

  <button id="calcBtn">Calculate</button>

  <!-- RESULTS -->
  <div class="section">
    <div class="content">
      <div>Competitor Cost: <span id="compCost" class="result">—</span></div>
      <div>Foodhub Cost: <span id="fhCost" class="result">—</span></div>
      <div>Monthly Savings: <span id="monthly" class="result">—</span></div>
      <div id="customerNotice" class="notice"></div>

      <canvas id="monthlyChart"></canvas>
      <canvas id="annualChart"></canvas>
    </div>
  </div>

</div>

<script>
const GOOGLE_SHEET_WEBHOOK = "https://script.google.com/macros/s/AKfycbyHXaO8IkvvzxmYae48wZGYzbW0Ld0rp27Xfml2UHoa_ufiAA-KyguqB6H5Ff2g0xuC/exec";
const el = id => document.getElementById(id);

let monthlyChart, annualChart;
let pitchMode = false;

el("calcBtn").addEventListener("click", calculate);

function togglePitch() {
  pitchMode = !pitchMode;
  el("inputs").classList.toggle("hidden", pitchMode);
}

function animateValue(elm, end) {
  let start = 0;
  let startTime = null;
  function step(t) {
    if (!startTime) startTime = t;
    const progress = Math.min((t - startTime) / 800, 1);
    elm.textContent =
      "£" + Math.floor(progress * (end - start) + start).toLocaleString();
    if (progress < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

function calculate() {
  const online = +el("onlineOrders").value;
  const offline = +el("offlineOrders").value;
  const cardRate = +el("cardRate").value / 100;
  const aov = +el("aov").value;

  const cardOrders = online * cardRate;

  const onlineBase =
    el("commissionScope").value === "card"
      ? cardOrders * aov
      : online * aov;

  const offlineBase =
    el("offlineCommission").value === "yes"
      ? offline * aov
      : 0;

  const commissionCost =
    (onlineBase + offlineBase) *
    (+el("compCommission").value / 100);

  const competitorCost =
    commissionCost +
    +el("compMonthlyFee").value +
    (cardOrders * +el("compFlatFee").value) +
    (online * +el("compServiceCharge").value);

  const foodhubCost =
    (online * aov * (+el("fhCommission").value / 100)) +
    +el("fhMonthlyFee").value +
    (cardOrders * +el("fhCardFee").value) -
    (online * +el("fhServiceCharge").value);

  const savings = competitorCost - foodhubCost;
  const annual = savings * 12;

  el("compCost").textContent = competitorCost.toFixed(2);
  el("fhCost").textContent = foodhubCost.toFixed(2);
  el("monthly").textContent = savings.toFixed(2);

  animateValue(el("annual"), annual);

  const customerExtra = online * +el("compServiceCharge").value;

  el("customerNotice").textContent =
    `Customers pay £${customerExtra.toFixed(0)} per month on ${el("competitorName").value}.`;

  drawCharts(competitorCost, foodhubCost, annual);
  saveToSheet(competitorCost, foodhubCost, savings, annual, customerExtra);
}

function saveToSheet(compCost, fhCost, monthlySavings, annualSavings, customerExtra) {
  const payload = JSON.stringify({
    agent: el("agent").value,
    store: el("store").value,
    competitor: el("competitorName").value,
    onlineOrders: el("onlineOrders").value,
    offlineOrders: el("offlineOrders").value,
    aov: el("aov").value,
    competitorCost: compCost.toFixed(2),
    foodhubCost: fhCost.toFixed(2),
    monthlySavings: monthlySavings.toFixed(2),
    annualSavings: annualSavings.toFixed(2),
    customerExtra: customerExtra.toFixed(2)
  });

  navigator.sendBeacon(
    GOOGLE_SHEET_WEBHOOK,
    new Blob([payload])
  );
}

function drawCharts(comp, fh, annual) {
  if (monthlyChart) monthlyChart.destroy();
  if (annualChart) annualChart.destroy();

  monthlyChart = new Chart(el("monthlyChart"), {
    type: "bar",
    data: {
      labels: ["Competitor", "Foodhub"],
      datasets: [{ data: [comp, fh] }]
    }
  });

  annualChart = new Chart(el("annualChart"), {
    type: "bar",
    data: {
      labels: ["Annual Savings"],
      datasets: [{ data: [annual] }]
    }
  });
}
</script>

</body>
</html>
