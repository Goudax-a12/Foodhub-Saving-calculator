<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foodhub Savings Calculator</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --foodhub-red:#E4002B;
  --foodhub-green:#1FA971;
  --bg:#F5F6F8;
}

body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 15px;
}

.container {
  max-width: 900px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 16px rgba(0,0,0,.12);
  margin: auto;
}

.header {
  background: var(--foodhub-red);
  color: white;
  padding: 16px;
}

.content { padding: 16px; }

h3 {
  margin-top: 25px;
  border-bottom: 2px solid #eee;
  padding-bottom: 6px;
}

.row {
  display: flex;
  flex-direction: column;
  margin-bottom: 12px;
}

label {
  font-size: 14px;
  margin-bottom: 4px;
}

input {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  background: var(--foodhub-red);
  color: white;
  border: none;
  padding: 12px;
  border-radius: 6px;
  cursor: pointer;
  width: 100%;
  margin-top: 15px;
}

.result {
  font-weight: bold;
  font-size: 16px;
}

.positive { color: var(--foodhub-green); }
.negative { color: var(--foodhub-red); }

.badge {
  background: var(--foodhub-green);
  color: white;
  padding: 10px;
  border-radius: 8px;
  text-align: center;
  margin-top: 10px;
  font-weight: bold;
}

.notice {
  background: #fff3cd;
  color: #856404;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
}

canvas { margin-top: 20px; }

@media print {
  button { display: none; }
  body { background: white; }
}
</style>
</head>

<body>

<div class="container">
  <div class="header">
    <h2>Foodhub vs Flipdish Savings Calculator</h2>
  </div>

  <div class="content">

    <h3>Agent & Store</h3>
    <div class="row"><label>Agent Name</label><input id="agent"></div>
    <div class="row"><label>Store Name</label><input id="store"></div>

    <h3>Business</h3>
    <div class="row"><label>Monthly Orders</label><input id="orders" type="number" value="1000"></div>
    <div class="row"><label>Average Order Value (£)</label><input id="aov" type="number" value="20"></div>
    <div class="row"><label>% Card Orders</label><input id="cardRate" type="number" value="70"></div>

    <h3>Flipdish</h3>
    <div class="row"><label>Commission (%)</label><input id="fdComm" value="2"></div>
    <div class="row"><label>Monthly Fee (£)</label><input id="fdFee" value="99"></div>
    <div class="row">
      <label>Service Charge (£ / order – customer pays, Flipdish keeps)</label>
      <input id="fdServiceAll" value="0.5">
    </div>

    <h3>Foodhub</h3>
    <div class="row"><label>Commission (%)</label><input id="fhComm" value="0"></div>
    <div class="row"><label>Monthly Fee (£)</label><input id="fhFee" value="0"></div>
    <div class="row"><label>Service Charge (£ / order paid to shop)</label><input id="fhService" value="0.5"></div>
    <div class="row"><label>Card Fee (£ / card order)</label><input id="fhCardFee" value="0.2"></div>

    <button onclick="calculate()">Calculate</button>

    <h3>Results</h3>
    <div class="row"><label>Flipdish Monthly Cost (£)</label><div id="fdCost" class="result"></div></div>
    <div class="row"><label>Foodhub Monthly Cost (£)</label><div id="fhCost" class="result"></div></div>
    <div class="row"><label>Monthly Savings (£)</label><div id="monthly" class="result"></div></div>
    <div class="row"><label>Annual Savings (£)</label><div id="annual" class="result"></div></div>

    <div id="confidence" class="badge"></div>
    <div id="customerNotice" class="notice"></div>

    <canvas id="monthlyChart"></canvas>
    <canvas id="annualChart"></canvas>

  </div>
</div>

<script>
const GOOGLE_SHEET_WEBHOOK = "https://script.google.com/macros/s/AKfycbxS7hvWEbB0Ki1q0FEoGwWPKRFa06oJFTwlrySCzcpbIUhUdy1KWSe7pEiz2lcu-_w_/exec";
let monthlyChart, annualChart;

function calculate() {
  const o = +orders.value;
  const a = +aov.value;
  const cardRate = (+cardRate.value) / 100;

  const fdCommission = (+fdComm.value) / 100;
  const fhCommission = (+fhComm.value) / 100;

  const turnover = o * a;
  const cardOrders = o * cardRate;

  const fdCost =
    (turnover * fdCommission) +
    (+fdFee.value);

  const fhCost =
    (turnover * fhCommission) +
    (+fhFee.value) +
    (cardOrders * +fhCardFee.value) -
    (o * +fhService.value);

  const savings = fdCost - fhCost;
  const annualSavings = savings * 12;

  const customerExtra =
    o * (+fdServiceAll.value);

  fdCostEl.innerText = fdCost.toFixed(2);
  fhCostEl.innerText = fhCost.toFixed(2);
  monthlyEl.innerText = savings.toFixed(2);
  annualEl.innerText = annualSavings.toFixed(2);

  confidence.innerText =
    `High confidence savings: £${annualSavings.toFixed(0)} per year`;

  customerNotice.innerText =
    `Your customers pay £${customerExtra.toFixed(0)} more per month on Flipdish, and the restaurant does not receive this.`;

  saveToSheet(fdCost, fhCost, savings, annualSavings, customerExtra);
  drawCharts(fdCost, fhCost, annualSavings);
}

function saveToSheet(fd, fh, s, a, c) {
  fetch(GOOGLE_SHEET_WEBHOOK, {
    method: "POST",
    body: JSON.stringify({
      agent: agent.value,
      store: store.value,
      orders: orders.value,
      aov: aov.value,
      fdCost: fd.toFixed(2),
      fhCost: fh.toFixed(2),
      monthlySavings: s.toFixed(2),
      annualSavings: a.toFixed(2),
      customerExtra: c.toFixed(2)
    })
  });
}

function drawCharts(fd, fh, a) {
  if (monthlyChart) monthlyChart.destroy();
  if (annualChart) annualChart.destroy();

  monthlyChart = new Chart(document.getElementById("monthlyChart"), {
    type: "bar",
    data: {
      labels: ["Flipdish", "Foodhub"],
      datasets: [{
        label: "Monthly Cost (£)",
        data: [fd, fh],
        backgroundColor: ["#E4002B", "#1FA971"]
      }]
    }
  });

  annualChart = new Chart(document.getElementById("annualChart"), {
    type: "bar",
    data: {
      labels: ["Annual Savings"],
      datasets: [{
        label: "£",
        data: [a],
        backgroundColor: ["#1FA971"]
      }]
    }
  });
}

const fdCostEl = document.getElementById("fdCost");
const fhCostEl = document.getElementById("fhCost");
const monthlyEl = document.getElementById("monthly");
const annualEl = document.getElementById("annual");

</script>

</body>
</html>
