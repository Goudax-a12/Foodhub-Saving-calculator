<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foodhub Savings Calculator</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f6f8;
  padding: 15px;
}
.container {
  max-width: 900px;
  background: #fff;
  margin: auto;
  padding: 20px;
  border-radius: 10px;
}
h2 { color: #E4002B; }
label { display: block; margin-top: 10px; }
input {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
}
button {
  margin-top: 20px;
  padding: 12px;
  width: 100%;
  background: #E4002B;
  color: #fff;
  border: none;
  font-size: 16px;
  cursor: pointer;
}
.result { font-weight: bold; margin-top: 5px; }
.badge {
  background: #1FA971;
  color: #fff;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
}
.notice {
  background: #fff3cd;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
}
canvas { margin-top: 20px; }
</style>
</head>

<body>

<div class="container">
<h2>Foodhub vs Flipdish Savings Calculator</h2>

<label>Agent Name</label>
<input id="agent">

<label>Store Name</label>
<input id="store">

<label>Monthly Orders</label>
<input id="orders" type="number" value="1000">

<label>Average Order Value (£)</label>
<input id="aov" type="number" value="20">

<label>% Card Orders</label>
<input id="cardRate" type="number" value="70">

<label>Flipdish Commission (%)</label>
<input id="fdComm" value="2">

<label>Flipdish Monthly Fee (£)</label>
<input id="fdFee" value="99">

<label>Flipdish Service Charge (£ / order – customer pays)</label>
<input id="fdService" value="0.5">

<label>Foodhub Commission (%)</label>
<input id="fhComm" value="0">

<label>Foodhub Monthly Fee (£)</label>
<input id="fhFee" value="0">

<label>Foodhub Service Charge (£ / order to shop)</label>
<input id="fhService" value="0.5">

<label>Foodhub Card Fee (£ / card order)</label>
<input id="fhCardFee" value="0.2">

<button id="calcBtn">Calculate</button>

<h3>Results</h3>
<div>Flipdish Monthly Cost (£): <span id="fdCost">—</span></div>
<div>Foodhub Monthly Cost (£): <span id="fhCost">—</span></div>
<div>Monthly Savings (£): <span id="monthly">—</span></div>
<div>Annual Savings (£): <span id="annual">—</span></div>

<div id="confidence" class="badge"></div>
<div id="customerNotice" class="notice"></div>

<canvas id="monthlyChart"></canvas>
<canvas id="annualChart"></canvas>
</div>

<script>
const GOOGLE_SHEET_WEBHOOK = "https://script.google.com/macros/s/AKfycbw_x4JA8j-sCq0SlmhXYrmNx_OqfiOtZHhOgWguxy7oBRmOvdqXLs3ZVhsSXD5wNT8N/exec";

const el = id => document.getElementById(id);

const agent = el("agent");
const store = el("store");
const orders = el("orders");
const aov = el("aov");
const cardRate = el("cardRate");
const fdComm = el("fdComm");
const fdFee = el("fdFee");
const fdService = el("fdService");
const fhComm = el("fhComm");
const fhFee = el("fhFee");
const fhService = el("fhService");
const fhCardFee = el("fhCardFee");

const fdCostEl = el("fdCost");
const fhCostEl = el("fhCost");
const monthlyEl = el("monthly");
const annualEl = el("annual");
const confidenceEl = el("confidence");
const customerNoticeEl = el("customerNotice");

let monthlyChart, annualChart;

el("calcBtn").addEventListener("click", calculate);

function calculate() {
  const o = +orders.value;
  const a = +aov.value;
  const cardPct = (+cardRate.value) / 100;

  const fdPct = (+fdComm.value) / 100;
  const fhPct = (+fhComm.value) / 100;

  const turnover = o * a;
  const cardOrders = o * cardPct;

  const fdCost = (turnover * fdPct) + (+fdFee.value);
  const fhCost =
    (turnover * fhPct) +
    (+fhFee.value) +
    (cardOrders * +fhCardFee.value) -
    (o * +fhService.value);

  const savings = fdCost - fhCost;
  const annualSavings = savings * 12;
  const customerExtra = o * +fdService.value;

  fdCostEl.textContent = fdCost.toFixed(2);
  fhCostEl.textContent = fhCost.toFixed(2);
  monthlyEl.textContent = savings.toFixed(2);
  annualEl.textContent = annualSavings.toFixed(2);

  confidenceEl.textContent =
    `High confidence savings: £${annualSavings.toFixed(0)} per year`;

  customerNoticeEl.textContent =
    `Your customers pay £${customerExtra.toFixed(0)} more per month on Flipdish.`;

  drawCharts(fdCost, fhCost, annualSavings);
  saveToSheet(fdCost, fhCost, savings, annualSavings, customerExtra);
}

function saveToSheet(fdCost, fhCost, monthlySavings, annualSavings, customerExtra) {
  const payload = JSON.stringify({
    agent: agent.value,
    store: store.value,
    orders: orders.value,
    aov: aov.value,
    cardRate: cardRate.value,
    fdCost: fdCost.toFixed(2),
    fhCost: fhCost.toFixed(2),
    monthlySavings: monthlySavings.toFixed(2),
    annualSavings: annualSavings.toFixed(2),
    customerExtra: customerExtra.toFixed(2)
  });

  navigator.sendBeacon(GOOGLE_SHEET_WEBHOOK, new Blob([payload]));
}

function drawCharts(fd, fh, annual) {
  if (monthlyChart) monthlyChart.destroy();
  if (annualChart) annualChart.destroy();

  monthlyChart = new Chart(el("monthlyChart"), {
    type: "bar",
    data: {
      labels: ["Flipdish", "Foodhub"],
      datasets: [{
        label: "Monthly Cost (£)",
        data: [fd, fh],
        backgroundColor: ["#E4002B", "#1FA971"]
      }]
    }
  });

  annualChart = new Chart(el("annualChart"), {
    type: "bar",
    data: {
      labels: ["Annual Savings"],
      datasets: [{
        label: "£",
        data: [annual],
        backgroundColor: ["#1FA971"]
      }]
    }
  });
}
</script>

</body>
</html>
