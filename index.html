<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unified Platform Savings Calculator</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f6f8;
  padding: 15px;
}
.container {
  max-width: 950px;
  background: #fff;
  margin: auto;
  padding: 20px;
  border-radius: 10px;
}
h2 { color: #E4002B; }
label { display: block; margin-top: 10px; font-weight: bold; }
small { color: #666; }
input, select {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
}
button {
  margin-top: 20px;
  padding: 12px;
  width: 100%;
  background: #E4002B;
  color: #fff;
  border: none;
  font-size: 16px;
  cursor: pointer;
}
.result { font-weight: bold; margin-top: 5px; }
.badge {
  background: #1FA971;
  color: #fff;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
}
.notice {
  background: #fff3cd;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
}
canvas { margin-top: 25px; }
</style>
</head>

<body>

<div class="container">
<h2>Foodhub Savings Calculator</h2>

<label>Agent Name</label>
<input id="agent">

<label>Store Name</label>
<input id="store">

<hr>

<h3>Orders</h3>

<label>Online Orders (Platform)</label>
<input id="onlineOrders" type="number" value="1000">

<label>Offline Orders (Phone / Walk-in)</label>
<input id="offlineOrders" type="number" value="300">

<label>% Card Orders (Online)</label>
<input id="cardRate" type="number" value="70">

<label>Average Order Value (£)</label>
<input id="aov" type="number" value="20">

<hr>

<h3>Competitor</h3>

<label>Competitor Platform</label>
<select id="competitorName">
  <option>Flipdish</option>
  <option>Just Eat</option>
  <option>Uber Eats</option>
  <option>Deliveroo</option>
  <option>Other</option>
</select>

<label>Commission (%)</label>
<input id="compCommission" value="2">

<label>Commission Applies To</label>
<select id="commissionScope">
  <option value="card">Card orders only</option>
  <option value="all">Card + Cash orders</option>
</select>

<label>Commission on Offline Orders?</label>
<select id="offlineCommission">
  <option value="no">No</option>
  <option value="yes">Yes</option>
</select>

<label>Monthly Fee (£)</label>
<input id="compMonthlyFee" value="99">

<label>Flat Rate Fee (£ / card order – shop pays)</label>
<input id="compFlatFee" value="0.20">

<label>Service Charge (£ / online order – customer pays)</label>
<input id="compServiceCharge" value="0.50">

<hr>

<h3>Foodhub</h3>

<label>Commission (%)</label>
<input id="fhCommission" value="0">

<label>Monthly Fee (£)</label>
<input id="fhMonthlyFee" value="0">

<label>Service Charge (£ / order paid to shop)</label>
<input id="fhServiceCharge" value="0.50">

<label>Card Fee (£ / card order – shop pays)</label>
<input id="fhCardFee" value="0.20">

<button id="calcBtn">Calculate</button>

<hr>

<h3>Results</h3>

<div>Competitor Total Monthly Cost (£): <span id="compCost">—</span></div>
<div>Foodhub Monthly Cost (£): <span id="fhCost">—</span></div>
<div>Monthly Savings (£): <span id="monthly">—</span></div>
<div>Annual Savings (£): <span id="annual">—</span></div>

<div id="confidence" class="badge"></div>
<div id="customerNotice" class="notice"></div>

<canvas id="monthlyChart"></canvas>
<canvas id="annualChart"></canvas>

</div>

<script>
const GOOGLE_SHEET_WEBHOOK = "https://script.google.com/macros/s/AKfycbzK63x5pqtq0vyW8uKc4-dhx6OhT_uS92-alsE8amh5YTQLNoY8OtjgK3DvDj9G7OVu/exec";

const el = id => document.getElementById(id);

const agent = el("agent");
const store = el("store");
const onlineOrders = el("onlineOrders");
const offlineOrders = el("offlineOrders");
const cardRate = el("cardRate");
const aov = el("aov");

const competitorName = el("competitorName");
const compCommission = el("compCommission");
const commissionScope = el("commissionScope");
const offlineCommission = el("offlineCommission");
const compMonthlyFee = el("compMonthlyFee");
const compFlatFee = el("compFlatFee");
const compServiceCharge = el("compServiceCharge");

const fhCommission = el("fhCommission");
const fhMonthlyFee = el("fhMonthlyFee");
const fhServiceCharge = el("fhServiceCharge");
const fhCardFee = el("fhCardFee");

const compCostEl = el("compCost");
const fhCostEl = el("fhCost");
const monthlyEl = el("monthly");
const annualEl = el("annual");
const confidenceEl = el("confidence");
const customerNoticeEl = el("customerNotice");

let monthlyChart, annualChart;

el("calcBtn").addEventListener("click", calculate);

function calculate() {
  const online = +onlineOrders.value;
  const offline = +offlineOrders.value;
  const totalOrders = online + offline;
  const cardPct = (+cardRate.value) / 100;

  const cardOrders = online * cardPct;
  const cashOrders = online - cardOrders;

  const orderValue = +aov.value;

  /* COMMISSION BASE */
  let onlineCommissionBase =
    commissionScope.value === "card"
      ? cardOrders * orderValue
      : online * orderValue;

  let offlineCommissionBase =
    offlineCommission.value === "yes"
      ? offline * orderValue
      : 0;

  const commissionBase = onlineCommissionBase + offlineCommissionBase;

  const commissionCost =
    commissionBase * (+compCommission.value / 100);

  const flatRateCost =
    cardOrders * +compFlatFee.value;

  const customerServiceCost =
    online * +compServiceCharge.value;

  const competitorTotalCost =
    commissionCost +
    +compMonthlyFee.value +
    flatRateCost +
    customerServiceCost;

  const foodhubCost =
    (online * orderValue * (+fhCommission.value / 100)) +
    +fhMonthlyFee.value +
    (cardOrders * +fhCardFee.value) -
    (online * +fhServiceCharge.value);

  const savings = competitorTotalCost - foodhubCost;
  const annualSavings = savings * 12;

  compCostEl.textContent = competitorTotalCost.toFixed(2);
  fhCostEl.textContent = foodhubCost.toFixed(2);
  monthlyEl.textContent = savings.toFixed(2);
  annualEl.textContent = annualSavings.toFixed(2);

  confidenceEl.textContent =
    `High confidence savings vs ${competitorName.value}: £${annualSavings.toFixed(0)} per year`;

  customerNoticeEl.textContent =
    `£${customerServiceCost.toFixed(0)} per month is paid by customers on ${competitorName.value} in service charges that do not go to the restaurant.`;

  drawCharts(competitorTotalCost, foodhubCost, annualSavings);
  saveToSheet(competitorTotalCost, foodhubCost, savings, annualSavings, customerServiceCost);
}

function saveToSheet(compCost, fhCost, monthlySavings, annualSavings, customerExtra) {
  const payload = JSON.stringify({
    agent: agent.value,
    store: store.value,
    competitor: competitorName.value,
    onlineOrders: onlineOrders.value,
    offlineOrders: offlineOrders.value,
    aov: aov.value,
    competitorCost: compCost.toFixed(2),
    foodhubCost: fhCost.toFixed(2),
    monthlySavings: monthlySavings.toFixed(2),
    annualSavings: annualSavings.toFixed(2),
    customerExtra: customerExtra.toFixed(2)
  });

  navigator.sendBeacon(GOOGLE_SHEET_WEBHOOK, new Blob([payload]));
}

function drawCharts(compCost, fhCost, annual) {
  if (monthlyChart) monthlyChart.destroy();
  if (annualChart) annualChart.destroy();

  monthlyChart = new Chart(el("monthlyChart"), {
    type: "bar",
    data: {
      labels: [competitorName.value, "Foodhub"],
      datasets: [{
        label: "Monthly Cost (£)",
        data: [compCost, fhCost],
        backgroundColor: ["#E4002B", "#1FA971"]
      }]
    }
  });

  annualChart = new Chart(el("annualChart"), {
    type: "bar",
    data: {
      labels: ["Annual Savings"],
      datasets: [{
        label: "£",
        data: [annual],
        backgroundColor: ["#1FA971"]
      }]
    }
  });
}
</script>

</body>
</html>
